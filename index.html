<!DOCTYPE html>
<html><body><pre>
<span style="color: #666666;">/*</span>
<span style="color: #666666;">*&nbsp;&nbsp;Inverse&nbsp;Kinematics</span>
<span style="color: #666666;">*&nbsp;&nbsp;464&nbsp;Robotics&nbsp;</span>
<span style="color: #666666;">*&nbsp;&nbsp;By:&nbsp;Dana&nbsp;Soule&nbsp;</span>
<span style="color: #666666;">*/</span>


arm[]&nbsp;link&nbsp;=&nbsp;<span style="color: #33997E;">new</span> arm[2];                    <span style="color: #666666;">//Array named arm with 2 links</span>
<span style="color: #E2661A;">PVector</span> base;                               <span style="color: #666666;">//places the location of base revolute joint</span>
<span style="color: #E2661A;">float</span> L = 400;                              <span style="color: #666666;">//the lenght of the link</span>
<span style="color: #E2661A;">PVector</span> position;                           <span style="color: #666666;">//Position of object (ball)</span>
<span style="color: #E2661A;">PVector</span> velocity;                           <span style="color: #666666;">//velocity of object movement speed of ball</span>



<span style="color: #33997E;">void</span> <span style="color: #006699;"><b>setup</b></span>() {
&nbsp;&nbsp;<span style="color: #006699;">size</span> (2300, 1800);                        <span style="color: #666666;">//defines the dimension of display window width and hight of pixels</span>

&nbsp;&nbsp;position&nbsp;=&nbsp;<span style="color: #33997E;">new</span> <span style="color: #006699;">PVector</span>(30, 0);            <span style="color: #666666;">//inital position of object</span>
&nbsp;&nbsp;velocity&nbsp;=&nbsp;<span style="color: #33997E;">new</span> <span style="color: #006699;">PVector</span>(2, 6);             <span style="color: #666666;">//(x,y) direction of inital movement</span>

&nbsp;&nbsp;velocity.<span style="color: #006699;">mult</span>(2);                         <span style="color: #666666;">//increasews the velocity by (n) times</span>
&nbsp;&nbsp;link[0]&nbsp;=&nbsp;<span style="color: #33997E;">new</span> arm(100, 100, L, 0);        <span style="color: #666666;">//sets link at index 0 of the array</span>

&nbsp;&nbsp;<span style="color: #669900;">for</span> (<span style="color: #E2661A;">int</span> l = 1; l &lt; link.<span style="color: #33997E;">length</span>; l++) {    <span style="color: #666666;">//arm1 = new link(100, 800, 200, 0);</span>
&nbsp;&nbsp;&nbsp;&nbsp;link[l]&nbsp;=&nbsp;<span style="color: #33997E;">new</span> arm(link[l-1], L, l);      <span style="color: #666666;">// arm2 = new link(arm1,200, degrees(-PI/4));</span>
&nbsp;&nbsp;}
&nbsp;&nbsp;base&nbsp;=&nbsp;<span style="color: #33997E;">new</span> <span style="color: #006699;">PVector</span>(<span style="color: #D94A7A;">width</span>/2, <span style="color: #D94A7A;">height</span>/2);     <span style="color: #666666;">//position of the base of the link 1 &quot;(width/2, height/2)&apos; is centerd</span>
}

<span style="color: #33997E;">void</span> <span style="color: #006699;"><b>draw</b></span>() {
&nbsp;&nbsp;<span style="color: #006699;">background</span>(44);
&nbsp;&nbsp;<span style="color: #006699;">noStroke</span>(); 
&nbsp;&nbsp;<span style="color: #006699;">fill</span>(#000000);                              <span style="color: #666666;">//hex code for color black</span>
&nbsp;&nbsp;<span style="color: #006699;">ellipse</span>(<span style="color: #D94A7A;">width</span>/2, <span style="color: #D94A7A;">height</span>/2, 150, 150);       <span style="color: #666666;">//(x,y, size, size) </span>

&nbsp;&nbsp;<span style="color: #666666;">//</span>
&nbsp;&nbsp;<span style="color: #E2661A;">int</span> total = link.<span style="color: #33997E;">length</span>;                  
&nbsp;&nbsp;arm&nbsp;end&nbsp;=&nbsp;link[link.<span style="color: #33997E;">length</span>-1];              <span style="color: #666666;">//is the last link position </span>
&nbsp;&nbsp;end.endEffector(position.x,&nbsp;position.y);&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #666666;">//the end effector will follow the object </span>
&nbsp;&nbsp;end.update();


&nbsp;&nbsp;<span style="color: #666666;">//All object features </span>
&nbsp;&nbsp;position.<span style="color: #006699;">add</span>(velocity);                       <span style="color: #666666;">// movement on the object</span>
&nbsp;&nbsp;<span style="color: #006699;">noStroke</span>();                                   <span style="color: #666666;">//no outline around ellipse</span>
&nbsp;&nbsp;<span style="color: #006699;">fill</span>(#FF00FF);                                <span style="color: #666666;">//hex color of ellipse fuchsia</span>
&nbsp;&nbsp;<span style="color: #006699;">ellipse</span>(position.x, position.y, 80, 80);

&nbsp;&nbsp;<span style="color: #666666;">//changes movement of the object direction </span>
&nbsp;&nbsp;<span style="color: #666666;">//with a bounce in the window</span>
&nbsp;&nbsp;<span style="color: #669900;">if</span> (position.x &gt; <span style="color: #D94A7A;">width</span> || position.x &lt; 0) {  
&nbsp;&nbsp;&nbsp;&nbsp;velocity.x&nbsp;*=&nbsp;-1;
&nbsp;&nbsp;}
&nbsp;&nbsp;<span style="color: #669900;">if</span> (position.y &gt; <span style="color: #D94A7A;">height</span> || position.y &lt; 0) {  
&nbsp;&nbsp;&nbsp;&nbsp;velocity.y&nbsp;*=&nbsp;-1;
&nbsp;&nbsp;}

&nbsp;&nbsp;<span style="color: #669900;">for</span> (<span style="color: #E2661A;">int</span> l = total-2; l&gt;=0; l--) {
&nbsp;&nbsp;&nbsp;&nbsp;link[l].follow(link[l+1]);
&nbsp;&nbsp;&nbsp;&nbsp;link[l].update();
&nbsp;&nbsp;}

&nbsp;&nbsp;link[0].setA(base);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #666666;">//sets the base in locked position</span>

&nbsp;&nbsp;<span style="color: #669900;">for</span> (<span style="color: #E2661A;">int</span> l = 1; l &lt; total; l++) {
&nbsp;&nbsp;&nbsp;&nbsp;link[l].setA(link[l-1].a2);
&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;<span style="color: #669900;">for</span> (<span style="color: #E2661A;">int</span> l = 0; l &lt; total; l++) {
&nbsp;&nbsp;&nbsp;&nbsp;link[l].show();
&nbsp;&nbsp;}
}
<span style="color: #33997E;">class</span> arm {
&nbsp;&nbsp;<span style="color: #E2661A;">PVector</span> a1 = <span style="color: #33997E;">new</span> <span style="color: #006699;">PVector</span>();        <span style="color: #666666;">//position of the base link with revolute joint</span>
&nbsp;&nbsp;<span style="color: #E2661A;">float</span> angle = 0;                   <span style="color: #666666;">//setting start angle at 0 degrees </span>
&nbsp;&nbsp;<span style="color: #E2661A;">float</span> l;                           <span style="color: #666666;">//length of arm</span>
&nbsp;&nbsp;<span style="color: #E2661A;">PVector</span> a2 = <span style="color: #33997E;">new</span> <span style="color: #006699;">PVector</span>();        <span style="color: #666666;">//position of the conecting revolute joint</span>

&nbsp;&nbsp;<span style="color: #666666;">//constructor for the first arm link</span>
&nbsp;&nbsp;arm(<span style="color: #E2661A;">float</span> x, <span style="color: #E2661A;">float</span> y, <span style="color: #E2661A;">float</span> len, <span style="color: #E2661A;">float</span> q) {    
&nbsp;&nbsp;&nbsp;&nbsp;a1.<span style="color: #006699;">set</span>(x, y);
&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;len;
&nbsp;&nbsp;&nbsp;&nbsp;angle&nbsp;=&nbsp;q;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;calcB();
&nbsp;&nbsp;}
&nbsp;&nbsp;<span style="color: #666666;">//constructor for the following arm link(s)</span>
&nbsp;&nbsp;arm(arm&nbsp;parent,&nbsp;<span style="color: #E2661A;">float</span> len, <span style="color: #E2661A;">float</span> q) {
&nbsp;&nbsp;&nbsp;&nbsp;a1&nbsp;=&nbsp;parent.a2.<span style="color: #006699;">copy</span>();
&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;len;
&nbsp;&nbsp;&nbsp;&nbsp;angle&nbsp;=&nbsp;q;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;calcB();
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #666666;">//follow(parent.a.x, parent.a.y);</span>
&nbsp;&nbsp;}

&nbsp;&nbsp;<span style="color: #33997E;">void</span> follow(arm child) {
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #E2661A;">float</span> targetX = child.a1.x; 
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #E2661A;">float</span> targetY = child.a1.y;
&nbsp;&nbsp;&nbsp;&nbsp;endEffector(targetX,&nbsp;targetY);
&nbsp;&nbsp;}
&nbsp;&nbsp;<span style="color: #666666;">/*</span>
<span style="color: #666666;">*&nbsp;The&nbsp;next&nbsp;three&nbsp;blocks&nbsp;are&nbsp;the&nbsp;inverse&nbsp;kinematics&nbsp;</span>
<span style="color: #666666;">&nbsp;&nbsp;&nbsp;*/</span>
&nbsp;&nbsp;<span style="color: #33997E;">void</span> endEffector(<span style="color: #E2661A;">float</span> objectx, <span style="color: #E2661A;">float</span> objecty) {
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #E2661A;">PVector</span> object = <span style="color: #33997E;">new</span> <span style="color: #006699;">PVector</span>(objectx, objecty);
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #E2661A;">PVector</span> direction = <span style="color: #E2661A;">PVector</span>.<span style="color: #006699;">sub</span>(object, a1);
&nbsp;&nbsp;&nbsp;&nbsp;angle&nbsp;=&nbsp;direction.<span style="color: #006699;">heading</span>();                   <span style="color: #666666;">//heading in this function uses inverse tan</span>
&nbsp;&nbsp;&nbsp;&nbsp;direction.<span style="color: #006699;">setMag</span>(l);
&nbsp;&nbsp;&nbsp;&nbsp;direction.<span style="color: #006699;">mult</span>(-1);
&nbsp;&nbsp;&nbsp;&nbsp;a1&nbsp;=&nbsp;<span style="color: #E2661A;">PVector</span>.<span style="color: #006699;">add</span>(object, direction);
&nbsp;&nbsp;}

&nbsp;&nbsp;<span style="color: #666666;">//sets a1 to copy what a2 end position is doing </span>
&nbsp;&nbsp;<span style="color: #33997E;">void</span> setA(<span style="color: #E2661A;">PVector</span> position) {
&nbsp;&nbsp;&nbsp;&nbsp;a1&nbsp;=&nbsp;position.<span style="color: #006699;">copy</span>(); 
&nbsp;&nbsp;&nbsp;&nbsp;calcB();
&nbsp;&nbsp;}&nbsp;&nbsp;

&nbsp;&nbsp;<span style="color: #666666;">//changes the angle with respect to the movement of dx,dy</span>
&nbsp;&nbsp;<span style="color: #33997E;">void</span> calcB() {
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #E2661A;">float</span> dx = l * <span style="color: #006699;">cos</span>(angle);        
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #E2661A;">float</span> dy = l * <span style="color: #006699;">sin</span>(angle);        
&nbsp;&nbsp;&nbsp;&nbsp;a2.<span style="color: #006699;">set</span>(a1.x+dx, a1.y+dy);
&nbsp;&nbsp;}

&nbsp;&nbsp;<span style="color: #33997E;">void</span> update() {
&nbsp;&nbsp;&nbsp;&nbsp;calcB();
&nbsp;&nbsp;}

&nbsp;&nbsp;<span style="color: #666666;">// The Links physical properties</span>
&nbsp;&nbsp;<span style="color: #33997E;">void</span> show() {
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #006699;">stroke</span>(255, 200);                 <span style="color: #666666;">//Link color</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #006699;">strokeWeight</span>(50);                 <span style="color: #666666;">//Link thickness</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #006699;">line</span>(a1.x, a1.y, a2.x, a2.y);     <span style="color: #666666;">//Position of links</span>
&nbsp;&nbsp;}
}

</pre></body></html>
